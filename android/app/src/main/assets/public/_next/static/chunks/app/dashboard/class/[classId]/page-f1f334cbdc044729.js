(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2168],{21595:(e,s,a)=>{"use strict";a.d(s,{StudentList:()=>G});var t=a(95155),n=a(12115),l=a(35317),r=a(56104),i=a(62177),d=a(90221),c=a(55594),o=a(87481),m=a(54165),h=a(30285),u=a(17759),x=a(62523),j=a(34301),p=a(50172);let f=c.Ik({studentName:c.Yj().min(1,{message:"Nama siswa tidak boleh kosong."}),nisn:c.Yj().min(1,{message:"NISN tidak boleh kosong."})});function N(e){let{classId:s}=e,[a,c]=(0,n.useState)(!1),[N,b]=(0,n.useState)(!1),{toast:g}=(0,o.dj)(),v=(0,i.mN)({resolver:(0,d.u)(f),defaultValues:{studentName:"",nisn:""}}),w=async e=>{b(!0);try{let a=(0,l.H9)(r.db,"classes",s);await (0,l.c4)(r.db,async t=>{let n=await t.get(a);if(!n.exists())throw"Kelas tidak ditemukan!";let i=(0,l.H9)((0,l.rJ)(r.db,"classes",s,"students"));t.set(i,{...e});let d=(n.data().studentCount||0)+1;t.update(a,{studentCount:d})}),g({title:"Sukses",description:"Siswa baru berhasil ditambahkan."}),v.reset(),c(!1)}catch(e){g({variant:"destructive",title:"Kesalahan",description:"Gagal menambahkan siswa: ".concat(e)})}finally{b(!1)}};return(0,t.jsxs)(m.lG,{open:a,onOpenChange:c,children:[(0,t.jsx)(m.zM,{asChild:!0,children:(0,t.jsxs)(h.$,{children:[(0,t.jsx)(j.A,{className:"mr-2 h-4 w-4"}),"Tambah Siswa"]})}),(0,t.jsxs)(m.Cf,{className:"sm:max-w-[425px]",children:[(0,t.jsxs)(m.c7,{children:[(0,t.jsx)(m.L3,{children:"Tambah Siswa Baru"}),(0,t.jsx)(m.rr,{children:"Masukkan nama dan NISN untuk siswa baru."})]}),(0,t.jsx)(u.lV,{...v,children:(0,t.jsxs)("form",{onSubmit:v.handleSubmit(w),className:"space-y-4 py-4",children:[(0,t.jsx)(u.zB,{control:v.control,name:"studentName",render:e=>{let{field:s}=e;return(0,t.jsxs)(u.eI,{children:[(0,t.jsx)(u.lR,{children:"Nama Siswa"}),(0,t.jsx)(u.MJ,{children:(0,t.jsx)(x.p,{placeholder:"Contoh: Budi",...s})}),(0,t.jsx)(u.C5,{})]})}}),(0,t.jsx)(u.zB,{control:v.control,name:"nisn",render:e=>{let{field:s}=e;return(0,t.jsxs)(u.eI,{children:[(0,t.jsx)(u.lR,{children:"NISN"}),(0,t.jsx)(u.MJ,{children:(0,t.jsx)(x.p,{placeholder:"Nomor Induk Siswa Nasional",...s})}),(0,t.jsx)(u.C5,{})]})}}),(0,t.jsx)(m.Es,{children:(0,t.jsxs)(h.$,{type:"submit",disabled:N,children:[N&&(0,t.jsx)(p.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Simpan"]})})]})})]})]})}var b=a(18763);let g=c.Ik({studentName:c.Yj().min(1,{message:"Nama siswa tidak boleh kosong."}),nisn:c.Yj().min(1,{message:"NISN tidak boleh kosong."})});function v(e){let{classId:s,studentId:a,currentStudent:c}=e,[j,f]=(0,n.useState)(!1),[N,v]=(0,n.useState)(!1),{toast:w}=(0,o.dj)(),k=(0,i.mN)({resolver:(0,d.u)(g),defaultValues:c});(0,n.useEffect)(()=>{j&&k.reset(c)},[j,c,k]);let y=async e=>{v(!0);try{let t=(0,l.H9)(r.db,"classes",s,"students",a);await (0,l.mZ)(t,{...e}),w({title:"Sukses",description:"Data siswa berhasil diperbarui."}),f(!1)}catch(e){w({variant:"destructive",title:"Kesalahan",description:"Gagal memperbarui data siswa."})}finally{v(!1)}},S=(0,t.jsxs)("div",{className:"relative flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors hover:bg-accent hover:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 w-full",children:[(0,t.jsx)(b.A,{className:"mr-2 h-4 w-4"}),(0,t.jsx)("span",{children:"Edit"})]});return(0,t.jsxs)(m.lG,{open:j,onOpenChange:f,children:[(0,t.jsx)(m.zM,{asChild:!0,children:S}),(0,t.jsxs)(m.Cf,{className:"sm:max-w-[425px]",children:[(0,t.jsxs)(m.c7,{children:[(0,t.jsx)(m.L3,{children:"Edit Data Siswa"}),(0,t.jsx)(m.rr,{children:"Ubah data siswa dan klik simpan."})]}),(0,t.jsx)(u.lV,{...k,children:(0,t.jsxs)("form",{onSubmit:k.handleSubmit(y),className:"space-y-4 py-4",children:[(0,t.jsx)(u.zB,{control:k.control,name:"studentName",render:e=>{let{field:s}=e;return(0,t.jsxs)(u.eI,{children:[(0,t.jsx)(u.lR,{children:"Nama Siswa"}),(0,t.jsx)(u.MJ,{children:(0,t.jsx)(x.p,{...s})}),(0,t.jsx)(u.C5,{})]})}}),(0,t.jsx)(u.zB,{control:k.control,name:"nisn",render:e=>{let{field:s}=e;return(0,t.jsxs)(u.eI,{children:[(0,t.jsx)(u.lR,{children:"NISN"}),(0,t.jsx)(u.MJ,{children:(0,t.jsx)(x.p,{...s})}),(0,t.jsx)(u.C5,{})]})}}),(0,t.jsx)(m.Es,{children:(0,t.jsxs)(h.$,{type:"submit",disabled:N,children:[N&&(0,t.jsx)(p.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Simpan Perubahan"]})})]})})]})]})}var w=a(90010),k=a(77223);function y(e){let{classId:s,studentId:a,studentName:i}=e,[d,c]=(0,n.useState)(!1),{toast:m}=(0,o.dj)(),h=async()=>{c(!0);try{let e=(0,l.H9)(r.db,"classes",s),t=(0,l.H9)(r.db,"classes",s,"students",a);await (0,l.c4)(r.db,async s=>{let a=await s.get(e);if(!a.exists())throw"Kelas tidak ditemukan!";s.delete(t);let n=Math.max(0,(a.data().studentCount||0)-1);s.update(e,{studentCount:n})}),m({title:"Sukses",description:"Siswa ".concat(i," berhasil dihapus.")})}catch(e){m({variant:"destructive",title:"Kesalahan",description:"Gagal menghapus siswa: ".concat(e)})}finally{c(!1)}},u=(0,t.jsxs)("div",{className:"relative flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm text-destructive outline-none transition-colors hover:bg-accent hover:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 w-full focus:bg-accent focus:text-destructive",children:[(0,t.jsx)(k.A,{className:"mr-2 h-4 w-4"}),(0,t.jsx)("span",{children:"Hapus"})]});return(0,t.jsxs)(w.Lt,{children:[(0,t.jsx)(w.tv,{asChild:!0,children:u}),(0,t.jsxs)(w.EO,{children:[(0,t.jsxs)(w.wd,{children:[(0,t.jsx)(w.r7,{children:"Apakah Anda yakin?"}),(0,t.jsxs)(w.$v,{children:["Tindakan ini akan menghapus siswa ",(0,t.jsx)("span",{className:"font-bold",children:i})," secara permanen. Aksi ini tidak dapat diurungkan."]})]}),(0,t.jsxs)(w.ck,{children:[(0,t.jsx)(w.Zr,{children:"Batal"}),(0,t.jsxs)(w.Rx,{onClick:h,disabled:d,className:"bg-destructive hover:bg-destructive/90",children:[d&&(0,t.jsx)(p.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Ya, Hapus"]})]})]})]})}var S=a(3925),A=a(85127),C=a(47655),I=a(59434);let E=n.forwardRef((e,s)=>{let{className:a,children:n,...l}=e;return(0,t.jsxs)(C.bL,{ref:s,className:(0,I.cn)("relative overflow-hidden",a),...l,children:[(0,t.jsx)(C.LM,{className:"h-full w-full rounded-[inherit]",children:n}),(0,t.jsx)(R,{}),(0,t.jsx)(C.OK,{})]})});E.displayName=C.bL.displayName;let R=n.forwardRef((e,s)=>{let{className:a,orientation:n="vertical",...l}=e;return(0,t.jsx)(C.VM,{ref:s,orientation:n,className:(0,I.cn)("flex touch-none select-none transition-colors","vertical"===n&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===n&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",a),...l,children:(0,t.jsx)(C.lr,{className:"relative flex-1 rounded-full bg-border"})})});R.displayName=C.VM.displayName;var H=a(37607),B=a(98214),T=a(55365),L=a(13497);function M(e){let{classId:s}=e,[a,i]=(0,n.useState)(!1),[d,c]=(0,n.useState)(!1),[u,j]=(0,n.useState)(""),[f,N]=(0,n.useState)([]),{toast:b}=(0,o.dj)(),g=(0,n.useCallback)(e=>{var s;let a=null==(s=e.target.files)?void 0:s[0];if(!a)return;j(a.name);let t=new FileReader;t.onload=e=>{try{var s;let a=new Uint8Array(null==(s=e.target)?void 0:s.result),t=S.LF(a,{type:"array"}),n=t.SheetNames[0],l=t.Sheets[n],r=S.Wp.sheet_to_json(l,{header:1}).slice(1).map(e=>{var s,a,t,n;return{studentName:(null==(s=e[0])?void 0:s.toString().trim())||"",nisn:(null==(a=e[1])?void 0:a.toString().trim())||"",gender:(null==(t=e[2])?void 0:t.toString().trim())==="Laki-laki"||(null==(n=e[2])?void 0:n.toString().trim())==="Perempuan"?e[2]:"Laki-laki"}}).filter(e=>e.studentName&&e.nisn);N(r),0===r.length&&b({variant:"destructive",title:"File Kosong atau Format Salah",description:"Pastikan file Excel memiliki data dan kolom yang benar: Nama Siswa, NISN, Jenis Kelamin."})}catch(e){b({variant:"destructive",title:"Gagal Membaca File",description:"Pastikan file yang Anda unggah adalah file Excel yang valid."}),w()}},t.readAsArrayBuffer(a)},[b]),v=async()=>{if(0===f.length)return void b({variant:"destructive",title:"Tidak ada data untuk diimpor."});c(!0);try{let e=(0,l.H9)(r.db,"classes",s);await (0,l.c4)(r.db,async a=>{let t=await a.get(e);if(!t.exists())throw Error("Kelas tidak ditemukan!");let n=(0,l.rJ)(r.db,"classes",s,"students"),i=(0,l.wP)(r.db);f.forEach(e=>{let s=(0,l.H9)(n);i.set(s,e)}),await i.commit();let d=(t.data().studentCount||0)+f.length;a.update(e,{studentCount:d})}),b({title:"Sukses",description:"".concat(f.length," siswa berhasil diimpor.")}),w(),i(!1)}catch(e){b({variant:"destructive",title:"Kesalahan",description:"Gagal mengimpor siswa: ".concat(e.message)})}finally{c(!1)}},w=()=>{j(""),N([]);let e=document.getElementById("excel-upload");e&&(e.value="")};return(0,t.jsxs)(m.lG,{open:a,onOpenChange:e=>{e||w(),i(e)},children:[(0,t.jsx)(m.zM,{asChild:!0,children:(0,t.jsxs)(h.$,{variant:"outline",children:[(0,t.jsx)(H.A,{className:"mr-2 h-4 w-4"}),"Impor dari Excel"]})}),(0,t.jsxs)(m.Cf,{className:"max-w-3xl",children:[(0,t.jsxs)(m.c7,{children:[(0,t.jsx)(m.L3,{children:"Impor Siswa dari File Excel"}),(0,t.jsx)(m.rr,{children:"Pilih file Excel untuk mengimpor data siswa secara massal. Pastikan format file sesuai."})]}),(0,t.jsxs)(T.Fc,{children:[(0,t.jsx)(L.A,{className:"h-4 w-4"}),(0,t.jsx)(T.XL,{children:"Penting!"}),(0,t.jsxs)(T.TN,{children:["Pastikan file Excel Anda memiliki 3 kolom dengan header berikut pada baris pertama: ",(0,t.jsx)("strong",{children:"Nama Siswa"}),", ",(0,t.jsx)("strong",{children:"NISN"}),", dan ",(0,t.jsx)("strong",{children:"Jenis Kelamin"}),' (isi dengan "Laki-laki" atau "Perempuan").']})]}),(0,t.jsxs)("div",{className:"py-4 space-y-4",children:[u?(0,t.jsxs)("div",{className:"flex items-center justify-center p-4 border rounded-md bg-muted",children:[(0,t.jsx)(B.A,{className:"h-6 w-6 text-green-600 mr-3"}),(0,t.jsx)("span",{className:"font-medium",children:u})]}):(0,t.jsxs)("div",{className:"relative border-2 border-dashed border-muted-foreground/50 rounded-lg p-8 flex flex-col items-center justify-center text-center",children:[(0,t.jsx)(H.A,{className:"h-12 w-12 text-muted-foreground"}),(0,t.jsx)("p",{className:"mt-4 text-sm text-muted-foreground",children:"Seret & lepas file atau klik untuk memilih"}),(0,t.jsx)(x.p,{id:"excel-upload",type:"file",className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",accept:".xlsx, .xls",onChange:g})]}),f.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsxs)("h3",{className:"mb-2 font-medium",children:["Pratinjau Data (",f.length," siswa ditemukan)"]}),(0,t.jsx)(E,{className:"h-64 w-full rounded-md border",children:(0,t.jsxs)(A.XI,{children:[(0,t.jsx)(A.A0,{className:"sticky top-0 bg-muted",children:(0,t.jsxs)(A.Hj,{children:[(0,t.jsx)(A.nd,{children:"Nama Siswa"}),(0,t.jsx)(A.nd,{children:"NISN"}),(0,t.jsx)(A.nd,{children:"Jenis Kelamin"})]})}),(0,t.jsx)(A.BF,{children:f.map((e,s)=>(0,t.jsxs)(A.Hj,{children:[(0,t.jsx)(A.nA,{children:e.studentName}),(0,t.jsx)(A.nA,{children:e.nisn}),(0,t.jsx)(A.nA,{children:e.gender})]},s))})]})})]})]}),(0,t.jsxs)(m.Es,{children:[(0,t.jsx)(h.$,{variant:"outline",onClick:()=>i(!1),disabled:d,children:"Batal"}),(0,t.jsx)(h.$,{onClick:v,disabled:d||0===f.length,children:d?(0,t.jsx)(p.A,{className:"mr-2 h-4 w-4 animate-spin"}):"Impor ".concat(f.length," Siswa")})]})]})]})}var F=a(66695),K=a(44838),P=a(68856),_=a(6874),z=a.n(_),J=a(12543),$=a(38350);function G(e){let{classId:s}=e,[a,i]=(0,n.useState)([]),[d,c]=(0,n.useState)(null),[o,m]=(0,n.useState)(!0);return(0,n.useEffect)(()=>{(async()=>{let e=(0,l.H9)(r.db,"classes",s),a=await (0,l.x7)(e);a.exists()&&c(a.data())})();let e=(0,l.P)((0,l.rJ)(r.db,"classes",s,"students"),(0,l.My)("studentName")),a=(0,l.aQ)(e,e=>{let s=[];e.forEach(e=>{s.push({id:e.id,...e.data()})}),i(s),m(!1)});return()=>a()},[s]),(0,t.jsxs)(F.Zp,{children:[(0,t.jsx)(F.aR,{children:(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)(h.$,{asChild:!0,variant:"outline",size:"icon",children:(0,t.jsx)(z(),{href:"/dashboard/classes",children:(0,t.jsx)(J.A,{className:"h-4 w-4"})})}),(0,t.jsxs)(F.ZB,{className:"text-2xl",children:["Kelola Siswa: ",(null==d?void 0:d.className)||(0,t.jsx)(P.E,{className:"h-6 w-24 inline-block"})]})]}),(0,t.jsx)(F.BT,{children:"Tambah, impor, edit, atau hapus data siswa dari kelas ini."})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(M,{classId:s}),(0,t.jsx)(N,{classId:s})]})]})}),(0,t.jsx)(F.Wu,{children:(0,t.jsxs)(A.XI,{children:[(0,t.jsx)(A.A0,{children:(0,t.jsxs)(A.Hj,{children:[(0,t.jsx)(A.nd,{children:"Nama Siswa"}),(0,t.jsx)(A.nd,{children:"NISN"}),(0,t.jsx)(A.nd,{className:"text-right",children:"Aksi"})]})}),(0,t.jsx)(A.BF,{children:o?[void 0,void 0,void 0].map((e,s)=>(0,t.jsxs)(A.Hj,{children:[(0,t.jsx)(A.nA,{children:(0,t.jsx)(P.E,{className:"h-5 w-32"})}),(0,t.jsx)(A.nA,{children:(0,t.jsx)(P.E,{className:"h-5 w-24"})}),(0,t.jsx)(A.nA,{className:"text-right",children:(0,t.jsx)(P.E,{className:"h-8 w-8 rounded-full"})})]},s)):a.length>0?a.map(e=>(0,t.jsxs)(A.Hj,{children:[(0,t.jsx)(A.nA,{className:"font-medium",children:e.studentName}),(0,t.jsx)(A.nA,{children:e.nisn}),(0,t.jsx)(A.nA,{className:"text-right",children:(0,t.jsxs)(K.rI,{children:[(0,t.jsx)(K.ty,{asChild:!0,children:(0,t.jsxs)(h.$,{variant:"ghost",size:"icon",className:"h-8 w-8",children:[(0,t.jsx)($.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"Opsi Siswa"})]})}),(0,t.jsxs)(K.SQ,{align:"end",children:[(0,t.jsx)(K._2,{asChild:!0,children:(0,t.jsx)(v,{classId:s,studentId:e.id,currentStudent:{studentName:e.studentName,nisn:e.nisn}})}),(0,t.jsx)(K._2,{asChild:!0,children:(0,t.jsx)(y,{classId:s,studentId:e.id,studentName:e.studentName})})]})]})})]},e.id)):(0,t.jsx)(A.Hj,{children:(0,t.jsx)(A.nA,{colSpan:3,className:"h-24 text-center",children:"Belum ada siswa di kelas ini."})})})]})})]})}},32383:()=>{},55365:(e,s,a)=>{"use strict";a.d(s,{Fc:()=>d,TN:()=>o,XL:()=>c});var t=a(95155),n=a(12115),l=a(74466),r=a(59434);let i=(0,l.F)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),d=n.forwardRef((e,s)=>{let{className:a,variant:n,...l}=e;return(0,t.jsx)("div",{ref:s,role:"alert",className:(0,r.cn)(i({variant:n}),a),...l})});d.displayName="Alert";let c=n.forwardRef((e,s)=>{let{className:a,...n}=e;return(0,t.jsx)("h5",{ref:s,className:(0,r.cn)("mb-1 font-medium leading-none tracking-tight",a),...n})});c.displayName="AlertTitle";let o=n.forwardRef((e,s)=>{let{className:a,...n}=e;return(0,t.jsx)("div",{ref:s,className:(0,r.cn)("text-sm [&_p]:leading-relaxed",a),...n})});o.displayName="AlertDescription"},59555:(e,s,a)=>{Promise.resolve().then(a.bind(a,21595))},83686:()=>{},85127:(e,s,a)=>{"use strict";a.d(s,{A0:()=>i,BF:()=>d,Hj:()=>c,XI:()=>r,nA:()=>m,nd:()=>o});var t=a(95155),n=a(12115),l=a(59434);let r=n.forwardRef((e,s)=>{let{className:a,...n}=e;return(0,t.jsx)("div",{className:"relative w-full overflow-auto",children:(0,t.jsx)("table",{ref:s,className:(0,l.cn)("w-full caption-bottom text-sm",a),...n})})});r.displayName="Table";let i=n.forwardRef((e,s)=>{let{className:a,...n}=e;return(0,t.jsx)("thead",{ref:s,className:(0,l.cn)("[&_tr]:border-b",a),...n})});i.displayName="TableHeader";let d=n.forwardRef((e,s)=>{let{className:a,...n}=e;return(0,t.jsx)("tbody",{ref:s,className:(0,l.cn)("[&_tr:last-child]:border-0",a),...n})});d.displayName="TableBody",n.forwardRef((e,s)=>{let{className:a,...n}=e;return(0,t.jsx)("tfoot",{ref:s,className:(0,l.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",a),...n})}).displayName="TableFooter";let c=n.forwardRef((e,s)=>{let{className:a,...n}=e;return(0,t.jsx)("tr",{ref:s,className:(0,l.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",a),...n})});c.displayName="TableRow";let o=n.forwardRef((e,s)=>{let{className:a,...n}=e;return(0,t.jsx)("th",{ref:s,className:(0,l.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",a),...n})});o.displayName="TableHead";let m=n.forwardRef((e,s)=>{let{className:a,...n}=e;return(0,t.jsx)("td",{ref:s,className:(0,l.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",a),...n})});m.displayName="TableCell",n.forwardRef((e,s)=>{let{className:a,...n}=e;return(0,t.jsx)("caption",{ref:s,className:(0,l.cn)("mt-4 text-sm text-muted-foreground",a),...n})}).displayName="TableCaption"}},e=>{var s=s=>e(e.s=s);e.O(0,[2992,3644,3524,5511,3366,8248,4053,7239,9032,8795,5521,9371,288,4131,8441,1684,7358],()=>s(59555)),_N_E=e.O()}]);